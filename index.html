<!DOCTYPE html>
<html lang="it">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Monitoraggio Particelle - Dispositivo portatile</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      padding-bottom: 10vh
    }

    table {
      width: 80%;
      margin: 20px auto;
      border-collapse: collapse;
    }

    th,
    td {
      border: 1px solid black;
      padding: 8px;
      text-align: center;
    }

    th {
      background-color: #333;
      color: white;
    }

    .anomaly {
      background-color: red;
      color: white;
      font-weight: bold;
    }
  </style>
</head>

<body>
  <h1>Monitoraggio Raggi Cosmici</h1>
  <button id="button">Reset</button>
  <table id="cosmicTable">
    <thead>
      <tr>
        <th>Timestamp</th>
        <th>Energy (eV)</th>
        <th>Particle Type</th>
        <th>Arrival Direction (Â°)</th>
        <th>Detected Flux</th>
      </tr>
    </thead>
    <tbody>
    </tbody>
  </table>

  <script>
    let data = JSON.parse(localStorage.getItem("cosmicData")) || [
      { time: "19:01:44", energy: "2.71e+08", type: "Muone", dir: 349, flux: 27.1 },
      { time: "18:53:36", energy: "5.65e+08", type: "Elettrone", dir: 262, flux: 34.3 },
      { time: "18:49:30", energy: "2.05e+08", type: "Muone", dir: 347, flux: 29.3 },
      { time: "18:30:25", energy: "5.29e+08", type: "Muone", dir: 316, flux: 23.8 },
      { time: "18:24:46", energy: "9.05e+08", type: "Muone", dir: 37, flux: 37.5 },
      { time: "18:15:11", energy: "5.28e+08", type: "Elettrone", dir: 238, flux: 19.9 },
      { time: "18:01:17", energy: "4.29e+08", type: "Muone", dir: 257, flux: 37.3 },
      { time: "17:55:14", energy: "4.99e+08", type: "Muone", dir: 80, flux: 17.9 },
      { time: "17:45:55", energy: "9.64e+08", type: "Muone", dir: 359, flux: 41.6 },
      { time: "17:30:30", energy: "9.67e+08", type: "Muone", dir: 290, flux: 12.7 },
      { time: "17:22:36", energy: "2.93e+08", type: "Muone", dir: 12, flux: 20.2 },
      { time: "17:17:55", energy: "4.14e+08", type: "Elettrone", dir: 203, flux: 20.3 },
      { time: "17:00:28", energy: "4.87e+08", type: "Muone", dir: 114, flux: 28.3 },
      { time: "16:57:08", energy: "1.64e+08", type: "Muone", dir: 295, flux: 19.9 },
      { time: "16:42:06", energy: "1.64e+08", type: "Muone", dir: 141, flux: 28.7 },
      { time: "16:37:22", energy: "1.68e+08", type: "Muone", dir: 248, flux: 42.7 },
      { time: "16:28:13", energy: "6.72e+08", type: "Protone", dir: 237, flux: 16.3 },
      { time: "16:17:53", energy: "4.29e+08", type: "Elettrone", dir: 315, flux: 16.7 },
      { time: "16:09:17", energy: "7.71e+08", type: "Muone", dir: 115, flux: 17.2 },
      { time: "15:52:49", energy: "1.91e+08", type: "Elettrone", dir: 266, flux: 49.0 },
      { time: "15:46:52", energy: "5.29e+08", type: "Muone", dir: 310, flux: 24.5 },
      { time: "15:37:26", energy: "5.41e+08", type: "Muone", dir: 182, flux: 15.7 },
      { time: "15:27:29", energy: "5.57e+08", type: "Muone", dir: 340, flux: 42.6 },
      { time: "15:16:02", energy: "3.19e+08", type: "Muone", dir: 91, flux: 44.7 },
      { time: "15:03:35", energy: "7.23e+08", type: "Muone", dir: 98, flux: 45.4 }
    ];


    function saveData() {
      localStorage.setItem("cosmicData", JSON.stringify(data));
    }


    function updateTable() {
      let tableBody = document.querySelector("#cosmicTable tbody");
      let newRow = document.createElement("tr");
      const currentMinute = new Date().getMinutes()
      const currentHour = new Date().getHours()
      const currentSeconds = new Date().getSeconds()
      const roundedMinute = Math.floor(currentMinute / 10) * 10;

      if (currentHour < 19) {
        return;
      }

      if ([10, 50].includes(roundedMinute)) {
        data.push({
          time: `${currentHour}:${currentMinute.toString().padStart(2, '0')}:${currentSeconds.toString().padStart(2, '0')}`,
          energy: "9.8e11",
          type: "Protone",
          dir: 180,
          flux: 502,
          anomaly: true
        });

        saveData();
      } else {
        let types = ["Muone", "Muone", "Muone", "Muone", "Elettrone", "Fotone", "kaone"];
        let type = types[Math.floor(Math.random() * types.length)];

        let newData = {
          time: `${currentHour}:${currentMinute.toString().padStart(2, '0')}:${currentSeconds.toString().padStart(2, '0')}`,
          energy: (Math.random() * (1e12 - 1e9) + 1e9).toExponential(2),
          type,
          dir: Math.floor(Math.random() * 360),
          flux: (Math.random() * 50).toFixed(1)
        };
        data.push(newData);
        saveData();
      }

      let lastEntry = data[data.length - 1];
      newRow.innerHTML = `
                <td>${lastEntry.time}</td>
                <td>${lastEntry.energy}</td>
                <td>${lastEntry.type}</td>
                <td>${lastEntry.dir}</td>
                <td class="${lastEntry.anomaly ? 'anomaly' : ''}">${lastEntry.flux}</td>
            `;

      tableBody.insertBefore(newRow, tableBody.firstChild);
    }

    // Aggiungiamo i dati iniziali
    data.forEach(entry => {
      let tableBody = document.querySelector("#cosmicTable tbody");
      let newRow = document.createElement("tr");
      newRow.innerHTML = `
                <td>${entry.time}</td>
                <td>${entry.energy}</td>
                <td>${entry.type}</td>
                <td>${entry.dir}</td>
                <td>${entry.flux}</td>
            `;
      tableBody.appendChild(newRow);
    });

    function getRandomInterval() {
      let minutes = Math.floor(Math.random() * (10 - 7 + 1) + 5); // Numero casuale tra 5 e 10 minuti
      let seconds = Math.floor(Math.random() * 60); // Numero casuale tra 0 e 59 secondi
      return (minutes * 60 + seconds) * 1000; // Converti in millisecondi
    }

    // setInterval(updateTable, getRandomInterval());
    setInterval(updateTable, 5000);
  </script>
</body>

</html>